schemaVersion: 2.1.0
metadata:
  generateName: dotnet-
  displayName: .NET 5.0
  description: Stack with .NET 5.0
  icon: https://github.com/dotnet/brand/raw/main/logo/dotnet-logo.png
  language: dotnet
  projectType: dotnet
  tags:
    - dotnet
  version: 1.0.1

projects:
  - name: dotnet-identity
    git:
      checkoutFrom:
        remote: origin
        revision: main
      remotes:
        origin: https://dev.azure.com/bowman-redhat/dotnet-msoa/_git/identity-gateway

components:
- name: dotnet
  container:
    image: registry.access.redhat.com/ubi8/dotnet-50:5.0
    mountSources: true
    env:
      - name: CONFIGURATION
        value: Debug
      - name: STARTUP_PROJECT
        value: app.csproj
      - name: ASPNETCORE_ENVIRONMENT
        value: Development
      - name: ASPNETCORE_URLS
        value: http://*:8080
      - name: MSOA_ENABLE_TLS
        value: 'false'
    endpoints:
    - name: http-8080
      targetPort: 8080
commands:
- id: build
  exec:
    workingDir: ${PROJECT_SOURCE}/Onbowman.MSOA.IdentityGateway
    commandLine: kill $(pidof dotnet); dotnet build -c $CONFIGURATION $STARTUP_PROJECT /p:UseSharedCompilation=false
    component: dotnet
    group:
      isDefault: true
      kind: build

- id: run
  exec:
    workingDir: ${PROJECT_SOURCE}/Onbowman.MSOA.IdentityGateway
    commandLine: dotnet run -c $CONFIGURATION --no-build --project $STARTUP_PROJECT --no-launch-profile
    component: dotnet
    group:
      isDefault: true
      kind: run
